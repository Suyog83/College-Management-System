<!-- head -->
<header class="bg-white border-b border-gray-200 sticky top-0 z-50">
  <div class="flex items-center justify-between px-3 py-2">
    <!-- left side -->
    <div class="flex items-center gap-4">
      <button class="p-2 hover:bg-gray-100 rounded-lg transition" (click)="toggleSidebar()">
        <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>
      <div>
        <h1 class="text-2xl font-bold text-gray-900">College Management System</h1>
        <p class="text-sm text-gray-500">Teacher Portal</p>
      </div>
    </div>

    <!-- right side -->
    <div class="flex items-center gap-4">
      <div class="text-right">
        <p class="text-sm font-semibold text-gray-900">{{ authService.currentUser() || 'Teacher' }}</p>
        <p class="text-xs text-gray-500">Administrator</p>
      </div>
      <button
        class="bg-red-600 hover:bg-red-700 text-white px-20 py-20 rounded-lg flex items-center gap-2 font-semibold transition transform hover:scale-105"
        (click)="authService.logout()">
        <svg class="w-10 h-8 " fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3"
            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
        </svg>

      </button>
    </div>
  </div>

  <!-- tab navigation
  <div class="border-t border-gray-200 px-6 flex gap-8">
    
    <button
      (click)="switchTab('dashboard')"
      class="py-3 px-2 border-b-2 font-semibold transition"
      [class.border-blue-600]="activeTab() === 'dashboard'"
      [class.text-blue-600]="activeTab() === 'dashboard'"
      [class.border-transparent]="activeTab() !== 'dashboard'"
      [class.text-gray-600]="activeTab() !== 'dashboard'"
    >
      
      [class.border-blue-600]="activeTab() === 'attendance'"
      [class.border-transparent]="activeTab() !== 'attendance'"
      [class.text-gray-600]="activeTab() !== 'attendance'"
    >
      ‚úì Mark Attendance
    </button>
  </div>  -->
</header>

<div class="flex h-screen ">
  <!-- sidebar of teacherbashborad -->
  @if (sidebarOpen()) {
  <aside class=" w-60 bg-white border-r border-gray-200 p-6 overflow-y-auto animate-slideIn">
    <nav class="space-y-4">
      <button (click)="switchTab('dashboard')"
        class="w-full flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition"
        [class.bg-gray-100]="activeTab() === 'dashboard'" [class.hover:bg-gray-100]="activeTab() !== 'dashboard'">
        <!-- <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-3m0 0l7-4 7 4M5 9v10a1 1 0 001 1h12a1 1 0 001-1V9m-9 11l4-4m0 0l4 4m-4-4v4"></path>
          </svg>-->
        <span class="nav-icon">üè†</span>
        <span class="font-medium text-gray-700">Dashboard</span>
      </button>
      <button (click)="switchTab('attendance')"
        class="w-full flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition"
        [class.bg-blue-100]="activeTab() === 'attendance'" [class.hover:bg-gray-100]="activeTab() !== 'attendance'">
        <!-- <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>-->
        <span class="nav-icon">üìä</span>
        <span class="font-medium text-gray-600">Mark Attendance</span>
      </button>
      <button (click)="switchTab('marks')"
        class="w-full flex items-center gap-3 px-4 py-3 rounded-lg cursor-pointer transition"
        [class.bg-gray-100]="activeTab() === 'marks'" [class.hover:bg-gray-100]="activeTab() !== 'marks'">
        <!-- <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>-->
        <span class="nav-icon">üìù</span>
        <span class="font-medium text-gray-700">Upload Marks</span>
      </button>
    </nav>
  </aside>
  }

  <!-- main content -->
  <main class="flex-1 p-8 animate-fadeIn  ml-64 flex-1 ">
    <!-- dashboard tab -->
    @if (activeTab() === 'dashboard') {

    <div class="mb-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-2">Teacher Dashboard</h2>
      <p class="text-gray-600">Welcome back! Here's your schedule for today</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
      @for (stat of stats(); track stat.label) {
      <div
        class="bg-white rounded-lg p-6 shadow-sm hover:shadow-lg transition-all duration-300 transform hover:-translate-y-1 border border-gray-100">

        <div
          [class]="'w-16 h-16 rounded-lg flex items-center justify-center mb-4 relative overflow-hidden ' + stat.color">

          <div class="absolute inset-0 opacity-30 bg-gradient-to-br"></div>


          <div class="relative z-10 text-white filter drop-shadow-lg">
            @switch (stat.icon) {
            @case ('courses') {

            <svg class="w-8 h-8" onclick="OnClickCourses()" fill="currentColor" viewBox="0 0 24 24">
              <path d="M4 6h16v2H4V6zm0 5h16v2H4v-2zm0 5h16v2H4v-2z" />
              <path d="M3 10h18V4H3v6zm0 7h18v-6H3v6z" opacity="0.2" />
            </svg>
            }
            @case ('students') {

            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z" />
            </svg>
            }
            @case ('classes') {

            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zm-5-5H7v5h7v-5z" />
              <circle cx="12" cy="13" r="1.5" fill="white" opacity="0.8" />
            </svg>
            }
            @case ('evaluations') {

            <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" />
              <circle cx="12" cy="12" r="10" fill="none" stroke="currentColor" stroke-width="1.5" opacity="0.3" />
            </svg>
            }
            }
          </div>
        </div>


        <div>
          <p class="text-gray-600 text-sm font-medium mb-1">{{ stat.label }}</p>
          <p class="text-3xl font-bold text-gray-900">{{ stat.value }}</p>
        </div>

        <!-- we can add notification like red dot on it -->
        <div class="absolute top-0 right-0 -m-2 opacity-10 w-0 h-24 rounded-full" [class]="stat.color"></div>
      </div>
      }
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- today schedule -->
      <div class="lg:col-span-2 bg-white rounded-lg p-6 shadow-sm">
        <div class="space-y-4">
          <h3 class="text-xl font-bold text-gray-900 mb-6">Today's Schedule</h3>
          @for (item of schedule; track item.time) {
          <div
            class="flex items-center justify-between p-4 border border-gray-200 rounded-lg hover:border-blue-300 transition">
            <div>
              <p class="text-sm font-semibold text-blue-600">{{ item.time }}</p>
              <p class="text-lg font-bold text-gray-900 mt-1">{{ item.subject }}</p>
              <p class="text-sm text-gray-600 mt-1">{{ item.room }} ‚Ä¢ {{ item.students }}</p>
            </div>
            <button class="bg-blue-50 hover:bg-blue-100 text-blue-600 font-semibold px-6 py-2 rounded-lg transition">
              Start
            </button>
          </div>
          }
        </div>
      </div>

      <!-- recent activities -->
      <div class="bg-white rounded-lg p-6 shadow-sm">
        <h3 class="text-xl font-bold text-gray-900 mb-6">Recent Activities</h3>
        <div class="space-y-4">
          @for (activity of activities; track activity.action) {
          <div class="pb-4 border-b border-gray-200 last:border-b-0">
            <div class="flex items-start gap-3">
              <div class="w-3 h-3 bg-green-500 rounded-full mt-1.5 flex-shrink-0"></div>
              <div class="flex-1">
                <p class="font-medium text-gray-900 text-sm">{{ activity.action }}</p>
                <p class="text-xs text-gray-600 mt-1">{{ activity.subject }}</p>
                <p class="text-xs text-gray-500 mt-2">{{ activity.time }}</p>
              </div>
            </div>
          </div>
          }
        </div>
      </div>
    </div>
    }

   <!-- @if (activeTab() === 'attendance') {
    <div class="mb-8  ">
      <h2 class="text-3xl font-bold text-gray-900 mb-2">Mark Attendance</h2>
      <p class="text-gray-600">Record student attendance for your classes</p>
    </div>

     filters section 
    <div class="bg-white rounded-lg p-6 shadow-sm mb-8 animate-slideUp">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
        <div class="transform transition hover:scale-105">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Select Subject</label>
          <select [ngModel]="selectedCourse()" (ngModelChange)="selectedCourse.set($event)"
            class="w-full px-4 h-11 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition bg-white cursor-pointer">
            @for (course of courses; track course) {
            <option [value]="course">{{ course }}</option>
            }
          </select>
        </div>

        < date  ->
        <div class="transform transition hover:scale-105">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Select Date</label>
          <input type="date" [ngModel]="selectedDate()" (ngModelChange)="selectedDate.set($event); onDateChange()"
            class="w-full px-4 h-11 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition" />
        </div>

        <-- present ->
        <div class="bg-green-50 rounded-lg p-4 text-center transform transition hover:scale-105 cursor-default">
          <p class="text-3xl font-bold text-green-600">{{ presentCount() }}</p>
          <p class="text-sm text-green-700 font-semibold">Present</p>
        </div>

        <-- absent  ->
        <div class="bg-red-50 rounded-lg p-4 text-center transform transition hover:scale-105 cursor-default">
          <p class="text-3xl font-bold text-red-600">{{ absentCount() }}</p>
          <p class="text-sm text-red-700 font-semibold">Absent</p>
        </div>
      </div>
    </div>

    <- success msg ->
    @if (success()) {
    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded mb-6 animate-slideUp">
      <p class="text-green-700 font-semibold whitespace-pre-wrap">{{ success() }}</p>
    </div>
    }

    <-- error msg ->
    @if (error()) {
    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded mb-6 animate-slideUp">
      <p class="text-red-700">{{ error() }}</p>
    </div>
    }

    <-- loading  ->
    @if (loading()) {
    <div class="flex justify-center items-center py-12">
      <div class="animate-spin">
        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
          </path>
        </svg>
      </div>
    </div>
    }

    <-- attendance table  ->
    <mat-card class="shadow-sm animate-slideUp">
      <mat-card-header>
        <!-- <mat-card-title>Attendance</mat-card-title> 
        <mat-card-subtitle>Marked for {{ selectedDate() }}</mat-card-subtitle>
        <mat-paginator  [pageSizeOptions]="[5, 10, 20]"
                 showFirstLastButtons
                 aria-label="Select page of periodic elements">
      </mat-paginator>->
      </mat-card-header>
      <mat-card-content class="overflow-x-auto">
        <table mat-table [dataSource]="attendanceStudents()" class="w-full mat-elevation-z0">
          <ng-container matColumnDef="roll">
            <th mat-header-cell *matHeaderCellDef class="text-left">Roll No</th>
            <td mat-cell *matCellDef="let student" class="font-medium">{{ student.id }}</td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef class="text-left">Student Name</th>
            <td mat-cell *matCellDef="let student">{{ student.name }}</td>
          </ng-container>

          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef class="text-center">Status</th>
            <td mat-cell *matCellDef="let student" class="text-center">
              <span [class]="'inline-block px-4 py-2 rounded-full text-xs font-semibold transform transition ' + 
                  (student.status === 'Present' 
                    ? 'bg-green-100 text-green-800 hover:scale-110' 
                    : 'bg-red-100 text-red-800 hover:scale-110')">
                {{ student.status }}
              </span>
            </td>
          </ng-container>

          <ng-container matColumnDef="actions">
            <th mat-header-cell *matHeaderCellDef class="text-center">Actions</th>
            <td mat-cell *matCellDef="let student" class="text-center">
              <div class="flex gap-2 justify-center">
                <button (click)="toggleStatus(student.id)" [class]="'p-2  transition transform hover:scale-110 ' +
                      (student.status === 'Present'
                        ? 'bg-green-100 text-green-600 hover:bg-green-200'
                        : 'bg-gray-100 text-gray-400 hover:bg-gray-200')">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                  </svg>
                </button><-- rounded-full for rounding the button ->
                <button (click)="toggleStatus(student.id)" [class]="'p-2  transition transform hover:scale-110 ' +
                      (student.status === 'Absent' 
                        ? 'bg-red-100 text-red-600 hover:bg-red-200'
                        : 'bg-gray-100 text-gray-400 hover:bg-gray-200')">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                  </svg>
                </button>
              </div>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
        
      </mat-card-content>
    </mat-card>-->
   @if (activeTab() === 'attendance') {
      <div class="mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-2">Mark Attendance</h2>
        <p class="text-gray-600">Record student attendance for your classes</p>
      </div>

      <!-- filters section -->
      <div class="bg-white rounded-lg p-6 shadow-sm mb-8 animate-slideUp">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
          <div class="transform transition hover:scale-105">
            <label class="block text-sm font-semibold text-gray-700 mb-2">Select Subject</label>
            <select 
              [ngModel]="selectedCourse()"
              (ngModelChange)="selectedCourse.set($event)"
              class="w-full px-4 h-11 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition bg-white cursor-pointer"
            >
              @for (course of courses; track course) {
                <option [value]="course">{{ course }}</option>
              }
            </select>
          </div>

          <div class="transform transition hover:scale-105">
            <label class="block text-sm font-semibold text-gray-700 mb-2">Select Date</label>
            <input 
              type="date"
              [ngModel]="selectedDate()"
              (ngModelChange)="selectedDate.set($event); onDateChange()"
              class="w-full px-4 h-11 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition"
            />
          </div>

          <div class="bg-green-50 rounded-lg p-4 text-center transform transition hover:scale-105 cursor-default">
            <p class="text-3xl font-bold text-green-600">{{ presentCount() }}</p>
            <p class="text-sm text-green-700 font-semibold">Present</p>
          </div>

          <div class="bg-red-50 rounded-lg p-4 text-center transform transition hover:scale-105 cursor-default">
            <p class="text-3xl font-bold text-red-600">{{ absentCount() }}</p>
            <p class="text-sm text-red-700 font-semibold">Absent</p>
          </div>
        </div>
      </div>

      <!-- success msg -->
      @if (success()) {
        <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded mb-6 animate-slideUp">
          <p class="text-green-700 font-semibold whitespace-pre-wrap">{{ success() }}</p>
        </div>
      }

      <!-- error msg -->
      @if (error()) {
        <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded mb-6 animate-slideUp">
          <p class="text-red-700">{{ error() }}</p>
        </div>
      }

      <!-- loading  -->
      @if (loading()) {
        <div class="flex justify-center items-center py-12">
          <div class="animate-spin">
            <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
            </svg>
          </div>
        </div>
      }

      <!-- Material Data Table -->
      @if (!loading()) {
        <mat-card class="shadow-sm animate-slideUp">
          <!-- Table Header -->
          <mat-card-header class="p-6 border-b border-gray-200">
            <div class="flex justify-between items-center">
              <div>
                <mat-card-title class="text-lg font-bold text-gray-900 mb-1">Attendance Records</mat-card-title>
                <mat-card-subtitle class="text-sm text-gray-600">Marked for {{ selectedDate() }}</mat-card-subtitle>
              </div>
              <div class="text-right">
                <p class="text-sm text-gray-600">Total Students: <span class="font-bold text-lg">{{ dataSource.data.length }}</span></p>
              </div>
            </div>
          </mat-card-header>

          <!-- Search Filter -->
          <div class="p-4 bg-gray-50 border-b border-gray-200">
            <input 
              matInput 
              placeholder="Search by name or roll number..." 
              (keyup)="applyFilter($event)"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:border-blue-500"
            />
          </div>

          <!-- Table Content -->
          <mat-card-content class="p-0">
            <div class="table-container overflow-x-auto">
              <table mat-table [dataSource]="dataSource" class="w-full">
                
                <!-- Sr.no Column -->
                <ng-container matColumnDef="srno">
                  <th mat-header-cell *matHeaderCellDef class="px-6 py-4 text-left font-semibold bg-gradient-to-r from-purple-600 to-purple-700 text-white">Sr.no</th>
                  <td mat-cell *matCellDef="let element; let i = dataIndex" class="px-6 py-4 border-b border-gray-200">{{ i + 1 }}</td>
                </ng-container>

                <!-- Roll No Column -->
                <ng-container matColumnDef="rollNo">
                  <th mat-header-cell *matHeaderCellDef class="px-6 py-4 text-left font-semibold bg-gradient-to-r from-purple-600 to-purple-700 text-white">Roll No</th>
                  <td mat-cell *matCellDef="let element" class="px-6 py-4 border-b border-gray-200 font-medium">{{ element.id }}</td>
                </ng-container>

                <!-- Name Column -->
                <ng-container matColumnDef="name">
                  <th mat-header-cell *matHeaderCellDef class="px-6 py-4 text-left font-semibold bg-gradient-to-r from-purple-600 to-purple-700 text-white">Student Name</th>
                  <td mat-cell *matCellDef="let element" class="px-6 py-4 border-b border-gray-200">{{ element.name }}</td>
                </ng-container>

                <!-- Status Column -->
                <ng-container matColumnDef="status">
                  <th mat-header-cell *matHeaderCellDef class="px-6 py-4 text-center font-semibold bg-gradient-to-r from-purple-600 to-purple-700 text-white">Status</th>
                  <td mat-cell *matCellDef="let element" class="px-6 py-4 border-b border-gray-200 text-center">
                    <span [class]="'inline-block px-3 py-1 rounded-full text-xs font-semibold ' + 
                      (element.status === 'Present' 
                        ? 'bg-green-100 text-green-800' 
                        : 'bg-red-100 text-red-800')">
                      {{ element.status }}
                    </span>
                  </td>
                </ng-container>

                <!-- Action Column -->
                <ng-container matColumnDef="action">
                  <th mat-header-cell *matHeaderCellDef class="px-6 py-4 text-center font-semibold bg-gradient-to-r from-purple-600 to-purple-700 text-white">Action</th>
                  <td mat-cell *matCellDef="let element" class="px-6 py-4 border-b border-gray-200">
                    <div class="flex gap-3 justify-center">
                      <!-- Present Button -->
                      <button
                        (click)="toggleStatus(element.id)"
                        [class]="'p-2 rounded-full transition transform hover:scale-125 ' +
                          (element.status === 'Present'
                            ? 'bg-green-100 text-green-600 hover:bg-green-200'
                            : 'bg-gray-100 text-gray-400 hover:bg-gray-200')"
                        title="Mark Present"
                        matTooltip="Mark Present"
                      >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                      </button>

                      <!-- Absent Button -->
                      <button
                        (click)="toggleStatus(element.id)"
                        [class]="'p-2 rounded-full transition transform hover:scale-125 ' +
                          (element.status === 'Absent'
                            ? 'bg-red-100 text-red-600 hover:bg-red-200'
                            : 'bg-gray-100 text-gray-400 hover:bg-gray-200')"
                        title="Mark Absent"
                        matTooltip="Mark Absent"
                      >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                      </button>

                      <!-- View Button -->
                      <button
                        class="p-2 rounded-full bg-blue-100 text-blue-600 hover:bg-blue-200 transition transform hover:scale-125"
                        title="View Details"
                        matTooltip="View Details"
                      >
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                        </svg>
                      </button>
                    </div>
                  </td>
                </ng-container>

                <!-- Header Row -->
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                
                <!-- Data Rows -->
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50 transition"></tr>
              </table>
            </div>
          </mat-card-content>

          <!-- Paginator -->
          <mat-paginator
            [pageSizeOptions]="pageSizeOptions"
            [pageSize]="pageSize()"
            showFirstLastButtons
            class="border-t border-gray-200">
          </mat-paginator>

          <!-- Table Footer -->
          <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-between items-center text-sm text-gray-600">
            <div>
              Showing 1 to {{ dataSource.data.length }} of {{ dataSource.data.length }} entries
            </div>
            <div class="flex gap-4">
              <span>Present: <span class="font-semibold text-green-600">{{ presentCount() }}</span></span>
              <span>Absent: <span class="font-semibold text-red-600">{{ absentCount() }}</span></span>
            </div>
          </div>
        </mat-card>
      }

      <!-- Save Button -->
      <div class="mt-8 flex justify-end animate-slideUp gap-3">
        <button
          class="bg-gray-600 hover:bg-gray-700 text-white px-8 py-3 rounded-lg font-semibold flex items-center gap-2 transform transition hover:scale-105 active:scale-95"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          Reset
        </button>
        <button
          (click)="saveAttendance()"
          [disabled]="loading()"
          class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-8 py-3 rounded-lg font-semibold flex items-center gap-2 transform transition hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl disabled:cursor-not-allowed"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
          </svg>
          {{ loading() ? 'Saving...' : 'Save Attendance' }}
        </button>
      </div>
    }
    

    <!-- loading state for dashboard -->
    @if (loading() && activeTab() === 'dashboard') {
    <div class="flex justify-center items-center py-12">
      <div class="animate-spin">
        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
          </path>
        </svg>
      </div>
    </div>
    }

    <!-- error state -->
    @if (error() && activeTab() === 'dashboard') {
    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
      <p class="text-red-700">{{ error() }}</p>
    </div>
    }


    <!--marks tab-->

    @if (activeTab() === 'marks') {
    <div class="mb-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-2">Upload Marks</h2>
      <p class="text-gray-600">Enter and manage student examination marks</p>
    </div>

    <!-- Filters section -->
    <div class="bg-white rounded-lg p-6 shadow-sm mb-8 animate-slideUp">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Course Selection -->
        <div class="transform transition hover:scale-105">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Select Course</label>
          <select [ngModel]="selectedCourseMarks()" (ngModelChange)="selectedCourseMarks.set($event)"
            class="w-full px-4 h-11 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition bg-white cursor-pointer">
            @for (course of courses; track course) {
            <option [value]="course">{{ course }}</option>
            }
          </select>
        </div>

        <!-- Exam Type Selection -->
        <div class="transform transition hover:scale-105">
          <label class="block text-sm font-semibold text-gray-700 mb-2">Select Exam Type</label>
          <select [ngModel]="selectedExamType()" (ngModelChange)="selectedExamType.set($event)"
            class="w-full px-4 h-11 border-2 border-gray-300 rounded-lg focus:outline-none focus:border-blue-500 transition bg-white cursor-pointer">
            @for (exam of examTypes; track exam.value) {
            <option [value]="exam.value">{{ exam.label }}</option>
            }
          </select>
        </div>
      </div>

      <!-- Bulk Upload Button -->
      <div class="mt-4">
        <button
          class="flex items-center gap-2 bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition">
          <span>üì§</span>
          Choose File
        </button>
        <p class="text-sm text-gray-600 mt-2">Upload marks using Excel</p>
      </div>
    </div>


    <!-- Success Message -->
    @if (success()) {
    <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded mb-6 animate-slideUp">
      <p class="text-green-700 font-semibold">{{ success() }}</p>
    </div>
    }

    <!-- Error Message -->
    @if (error()) {
    <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded mb-6 animate-slideUp">
      <p class="text-red-700">{{ error() }}</p>
    </div>
    }

    <!-- Marks Table -->
    <div class="bg-white rounded-lg shadow-sm animate-slideUp">
      <div class="p-6 border-b border-gray-200">
        <div class="flex justify-between items-center">
          <div>
            <h3 class="text-lg font-bold text-gray-900">Upload Marks</h3>
            <p class="text-sm text-gray-600">{{ selectedCourseMarks() }} - {{ selectedExamType() | titlecase }}</p>
          </div>
          <div class="text-right">
            <p class="text-sm text-gray-600">Average: <span class="font-bold text-lg">{{ getAverageMarks() }}</span></p>
          </div>
        </div>
      </div>

      <!-- Loading State -->
      @if (marksLoading()) {
      <div class="flex justify-center items-center py-12">
        <div class="animate-spin">
          <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15">
            </path>
          </svg>
        </div>
      </div>
      }

      <!-- Marks Table -->
      @if (!marksLoading()) {
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="border-b border-gray-200 bg-gray-50">
              <th class="text-left px-6 py-3 font-semibold text-gray-900">Roll No</th>
              <th class="text-left px-6 py-3 font-semibold text-gray-900">Student Name</th>
              <th class="text-center px-6 py-3 font-semibold text-gray-900">Marks Obtained</th>
              <th class="text-center px-6 py-3 font-semibold text-gray-900">Max Marks</th>
              <th class="text-center px-6 py-3 font-semibold text-gray-900">Percentage</th>
              <th class="text-center px-6 py-3 font-semibold text-gray-900">Grade</th>
            </tr>
          </thead>
          <tbody>
            @for (mark of studentMarks(); track mark.student_id) {
            <tr class="border-b border-gray-200 hover:bg-gray-50 transition">
              <td class="px-6 py-3 font-medium text-gray-900">{{ mark.student_id }}</td>
              <td class="px-6 py-3 text-gray-700">{{ mark.student_name }}</td>
              <td class="px-6 py-3 text-center">
                <input type="number" min="0" max="100" [value]="mark.marks_obtained"
                  (change)="updateMarks(mark.student_id, $any($event.target).value)"
                  class="w-20 px-2 py-1 border border-gray-300 rounded text-center focus:outline-none focus:border-blue-500" />
              </td>
              <td class="px-6 py-3 text-center text-gray-700">{{ mark.max_marks }}</td>
              <td class="px-6 py-3 text-center">
                <span [class]="'inline-block px-3 py-1 rounded-full text-sm font-semibold ' + 
                    (mark.percentage >= 85 
                      ? 'bg-green-100 text-green-800' 
                      : mark.percentage >= 70 
                      ? 'bg-blue-100 text-blue-800'
                      : mark.percentage >= 50
                      ? 'bg-yellow-100 text-yellow-800'
                      : 'bg-red-100 text-red-800')">
                  {{ mark.percentage }}%
                </span>
              </td>
              <td class="px-6 py-3 text-center">
                <span [class]="'inline-block px-3 py-1 rounded font-bold ' + 
                    (mark.grade === 'A+' || mark.grade === 'A' 
                      ? 'bg-green-100 text-green-800' 
                      : mark.grade === 'B+' || mark.grade === 'B'
                      ? 'bg-blue-100 text-blue-800'
                      : mark.grade === 'C+' || mark.grade === 'C'
                      ? 'bg-yellow-100 text-yellow-800'
                      : mark.grade === 'D'
                      ? 'bg-orange-100 text-orange-800'
                      : 'bg-red-100 text-red-800')">
                  {{ mark.grade }}
                </span>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
      }
    </div>

    <!-- Save Button -->
    <div class="mt-8 flex justify-end animate-slideUp">
      <button (click)="saveMarks()" [disabled]="marksLoading()"
        class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white px-8 py-3 rounded-lg font-semibold flex items-center gap-2 transform transition hover:scale-105 active:scale-95 shadow-lg hover:shadow-xl disabled:cursor-not-allowed">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
        </svg>
        {{ marksLoading() ? 'Saving...' : 'Save Marks' }}
      </button>
    </div>
    }


  </main>
</div>