<nav class="navbar">
  <div class="nav-left">
    <button class="menu-btn" (click)="toggleSidebar()" title="Toggle menu">‚ò∞</button>
    <h2 class="nav-title">College Management System</h2>
    <p class="nav-subtitle">Student Portal</p>
  </div>
  <div class="nav-right">
    <span class="user-info">{{ authService.currentUser() }}</span>
    <button class="logout-btn" (click)="authService.logout()">
      <span class="logout-icon">‚üµ</span> Logout
    </button>
  </div>
</nav>

<div class="dashboard-wrapper">
  <!-- Sidebar Navigation -->
  <aside class="sidebar" [class.open]="sidebarOpen()">
    <nav class="sidebar-nav">
      <a routerLink="/dashboard" class="nav-item active" (click)="closeSidebar()">
        <span class="nav-icon">üè†</span>
        <span class="nav-text">Dashboard</span>
      </a>
      <a routerLink="/attendance" class="nav-item" (click)="closeSidebar()">
        <span class="nav-icon">üìä</span>
        <span class="nav-text">My Attendance</span>
      </a>
      <a routerLink="/marks" class="nav-item" (click)="closeSidebar()">
        <span class="nav-icon">üìù</span>
        <span class="nav-text">My Marks</span>
      </a>
    </nav>
  </aside>

  <!-- Overlay for mobile -->
  <div class="sidebar-overlay" *ngIf="sidebarOpen()" (click)="closeSidebar()"></div>

  <main class="main-content">
    <div class="dashboard-container">
      <!-- Error Alert -->
      @if (error()) {
        <div class="alert alert-error">
          <span class="alert-icon">‚ö†Ô∏è</span>
          {{ error() }}
        </div>
      }

      <!-- Loading State -->
      @if (loading()) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p>Loading your dashboard...</p>
        </div>
      }

      @if (!loading()) {
        <!-- Header Section -->
        <div class="dashboard-header">
          <div>
            <h1 class="welcome-title">Student Dashboard</h1>
            <p class="welcome-subtitle">Track your academic progress and upcoming classes</p>
          </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
          <!-- Attendance Rate Card -->
          <div class="stat-card attendance-card">
            <div class="stat-icon">‚è±Ô∏è</div>
            <div class="stat-value">{{ attendancePercentage() }}%</div>
            <div class="stat-label">Attendance Rate</div>
            <div class="stat-subtext">
              {{ presentCount() }} Present / {{ absentCount() }} Absent
            </div>
          </div>

          <!-- Total Classes Card -->
          <div class="stat-card classes-card">
            <div class="stat-icon">üìö</div>
            <div class="stat-value">{{ totalClasses() }}</div>
            <div class="stat-label">Total Classes</div>
            <div class="stat-subtext">Overall attendance count</div>
          </div>

          <!-- Present Count Card -->
          <div class="stat-card present-card">
            <div class="stat-icon">‚úì</div>
            <div class="stat-value">{{ presentCount() }}</div>
            <div class="stat-label">Classes Present</div>
            <div class="stat-subtext">Great job attending!</div>
          </div>

          <!-- Absent Count Card -->
          <div class="stat-card absent-card">
            <div class="stat-icon">‚úï</div>
            <div class="stat-value">{{ absentCount() }}</div>
            <div class="stat-label">Classes Absent</div>
            <div class="stat-subtext">Mark of absence</div>
          </div>
        </div>

        <!-- Student Info and Attendance History -->
        <div class="content-grid">
          <!-- Student Profile Card -->
          <div class="profile-section">
            <div class="profile-header">
              <h3>Student Information</h3>
              <button class="refresh-btn" (click)="refreshData()" title="Refresh data">
                ‚Üª Refresh
              </button>
            </div>

            <div class="profile-content">
              <div class="profile-item">
                <label>Full Name</label>
                <p>{{ studentName() || 'N/A' }}</p>
              </div>
              <div class="profile-item">
                <label>Student ID</label>
                <p>{{ studentId() || 'N/A' }}</p>
              </div>
              <div class="profile-item">
                <label>Roll Number</label>
                <p>{{ rollNumber() || 'N/A' }}</p>
              </div>

              <div class="attendance-percentage-display">
                <div class="circle-progress">
                  <svg viewBox="0 0 100 100">
                    <circle
                      cx="50"
                      cy="50"
                      r="45"
                      fill="none"
                      stroke="#e5e7eb"
                      stroke-width="3"
                    />
                    <circle
                      cx="50"
                      cy="50"
                      r="45"
                      fill="none"
                      stroke="#3b82f6"
                      stroke-width="3"
                      stroke-dasharray="282.7"
                      [style.stroke-dashoffset]="282.7 - (282.7 * attendancePercentage()) / 100"
                      stroke-linecap="round"
                    />
                  </svg>
                  <div class="progress-text">
                    <span class="percentage">{{ attendancePercentage() }}%</span>
                    <span class="label">Attendance</span>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Attendance Section -->
          <div class="attendance-section">
            <div class="section-header">
              <h3>Recent Attendance</h3>
              <span class="record-count">{{ attendanceHistory().length }} Records</span>
            </div>

            @if (attendanceHistory().length === 0) {
              <div class="no-records">
                <p>üìã No attendance records yet</p>
              </div>
            } @else {
              <div class="attendance-list">
                @for (record of getRecentRecords(); track $index) {
                  <div
                    class="attendance-item"
                    [class.present]="record.status === 'P'"
                    [class.absent]="record.status === 'A'"
                  >
                    <div class="item-left">
                      <span class="item-date">{{ record.date }}</span>
                      <span class="item-time">{{ record.time }}</span>
                    </div>
                    <span
                      class="status-badge"
                      [class.status-present]="record.status === 'P'"
                      [class.status-absent]="record.status === 'A'"
                    >
                      {{ record.status === 'P' ? '‚úì PRESENT' : '‚úï ABSENT' }}
                    </span>
                  </div>
                }
              </div>

              @if (attendanceHistory().length > 10) {
                <div class="view-all">
                  <button class="view-all-btn">View All {{ attendanceHistory().length }} Records</button>
                </div>
              }
            }
          </div>
        </div>

        <!-- Quick Stats Section -->
        <div class="quick-stats-section">
          <h3>Attendance Overview</h3>
          <div class="stats-overview">
            <div class="stat-row">
              <span class="stat-name">Total Classes Attended</span>
              <div class="stat-bar">
                <div
                  class="bar-fill present-fill"
                  [style.width.%]="presentCount() > 0 ? (presentCount() / totalClasses()) * 100 : 0"
                ></div>
              </div>
              <span class="stat-number">{{ presentCount() }}/{{ totalClasses() }}</span>
            </div>
          </div>
        </div>
      }
    </div>
  </main>
</div>